<!DOCTYPE>
<html>
    <head>
        <style>
         .ui-btn-text{ display:none;}
          .ui-loader{ display:none;}
        </style>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=0.5,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
        <meta name="format-detection" content="telephone=no" />
        <title>wap-个人管理</title>
        <link rel="stylesheet" href="css/reset.css"/>
        <link rel="stylesheet" href="css/people.css"/>
        <script src="js/jquery-1.8.3.min.js"></script>
        <script src="js/address.js"></script>
        <!--<script src="js/jquery.mobile-1.3.2.min.js"></script>-->
    </head>

    <body>
        <div data-role="page" id="pageone">
            <div class="header">
                <span class="sp1">我的账户</span>
                <span class="fl hsp2" onclick="history.go(-1)" style="cursor:hand" > < </span> 
                <!--<input type="button" name="button1" id="button1" value="返回" onclick="history.go(-1)">-->
            </div>
            <div class="pertouimg" style="text-align:center; ">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                <span class="fl"><img src="{if $info['avatar']}attach/$info['avatar']{else}images/touxiang.jpg{/if}" width="120px" height="120px" id="img" style=" border-radius:100%" /></span>
                <span class="fr numbercol perpadtop">
                 <!-- <span style="color:#333" class="fr">修改头像</span>-->
                  <a class="a-upload">
                     <input  type="file" id="upfile" accept="image/png,image/gif,image/jpg,image/jpeg" name="file" class="fr" />修改头像 >
                    </a>
            
                    <!--<input type="button" id="upJQuery" value="确定" class="fr">-->
                    <span style=" padding-left:6px;"><a href=""><img src="images/jiantou.png" width="10px"/></a></span>
                </span>

                <div class="clear"></div>
            </div> 
            <div class="colpad">
                <span class="fl"> 手机号 :</span>
                <span class="fr numbercol">
                    <span class="mobile" ></span>
                    <span class="padlefts" id="mobile"><a href="/wapuinfo.php?action=iphone">{if $user[mobile]}$user[mobile]{else}{eval echo session('mobile')}{/if}</a></span>	
                    <span style=" padding-left:6px;"><a href=""><img src="images/jiantou.png" width="10px"/></a></span>
                </span>

                <div class="clear"></div>
            </div> 
            <div class="numberp percol">
                基本信息<br/>可用于参加车评网下线活动及领取活动奖励，车评网会严格保密用户信息
            </div> 

            <div class="colpad">
                <span class="username" > 姓&nbsp;&nbsp;&nbsp;名 :</span>
                <span class="padlefts" >$user[username]</span>
            </div>
            <div class="colpad">
                <span class="birthday"> 生&nbsp;&nbsp;&nbsp;日 :</span>
                <span class="padleft">$info[birthday]</span>
            </div>

            <div class="colpad">
                <span class="province"> 所在地:</span>
                <span class="padleft">{eval echo $info[province].'-'.$info[city].'-'.$info[county]}</span>
            </div> 

            <div class="colpad">
                <span class="address"> 地&nbsp;&nbsp;&nbsp;址 :</span>
                <span class="padleft">$info[address]</span>
            </div>

            <div class="colpad">
                <span class="zipcode"> 邮&nbsp;&nbsp;&nbsp;编 :</span>
                <span class="padleft">$info[zipcode]</span>
            </div> 

            <div class="colpad">
                <span class="qq"> Q&nbsp;&nbsp;&nbsp;Q :</span>
                <span 
                    class="padleft">$info[qq]</span>
            </div>
        </div> 
        <a class="xiugaimi" href="/waplogin.php?action=RepassWord&p=1"/>修改密码</a>
    <p class="text-align"><font color="#999">用户ID:$user[id]</font></p>
    <p class="text-align"><input type="submit" class="xiugai"  value="退出登录" onclick='location.href="/waplogin.php?action=unsetuser"'/></p>

    <script>
        //修改地址
         $('#s_county').live('change',function(){
             var province = $("#s_province").val()
             var county = $(this).val();
             var city = $("#s_city").val();
            $.post("/wapuinfo.php?action=Address", {province: province, city: city,county: county}, function (msg) {

            })  
       
         });
        function data_update(e, type) {
            var obj = $(e);
            if (obj.attr('ck')) {
                return false;
            }
            obj.attr('ck', 1);
            var values = obj.html();
            if(type=='province'){
                obj.html("<select id='s_province'></select><select id='s_city'></select><select id='s_county'></select>");//修改地址
                _init_area();
            }else{
            var intype=type=='birthday'?'date':'text';
            obj.html("<input type='"+intype+"' id='edit" + values + "' value='" + values + "' class='donginp'>");
            }
            $("#edit" + values).focus().live("blur", function () {
                var editval = $(this).val();
                if (editval != values) {
                    $.post("/wapuinfo.php?action=Person", {editval: editval, type: type}, function (msg) {
                        if (msg == 1) {
                            $("#username").html(editval);
                            location.href = "";
                        } else if (msg == 2) {
                            alert("用户名不符合规则");
                            location.href = "";
                        } else if (msg == 3) {
                            alert("修改失败!请重试!");
                            location.href = "";
                        }

                    })
                }
                obj.attr('ck', '');
                obj.html(editval);
            })
        }
        //修改电话号码和姓名
        function data_updates(e, type) {
            var obj = $(e);
            if (obj.attr('ck')) {
                return false;
            }
            obj.attr('ck', 1);
            var values = obj.html();
            obj.html("<input id='edit" + values + "' value='" + values + "' class='donginp'>");
            $("#edit" + values).focus().live("blur", function () {
                var editval = $(this).val();
                if (editval != values) {
                    $.post("/wapuinfo.php?action=Persons", {editval: editval, type: type}, function (msg) {
                        if (msg == 1) {
                            $("#username").html(editval);
                            location.href = "";
                        } else if (msg == 2) {
                            alert("用户名不符合规则");
                            location.href = "";
                        } else if (msg == 3) {
                            alert("修改失败!请重试!");
                            location.href = "";
                        }

                    })
                }
                obj.attr('ck', '');
                obj.html(editval);
            })
        }
        //修改用户名子
        $(".username").parent('div').on("click", function () {
             data_updates($(".username").next('span'), 'username');
        });  
        //修改生日
        $(".birthday").parent('div').on("click", function () {
             data_update($(".birthday").next('span'), 'birthday');
        });
        //修改所在地
        $(".province").parent('div').on("click", function () {
             data_update($(".province").next('span'), 'province');
        }); 
        //修改地址
        $(".address").parent('div').on("click", function () {
             data_update($(".address").next('span'), 'address');
        }); 
        //修改邮编
        $(".zipcode").parent('div').on("click", function () {
             data_update($(".zipcode").next('span'), 'zipcode');
        });
        //修改QQ
        $(".qq").parent('div').on("click", function () {
             data_update($(".qq").next('span'), 'qq');
        });
        //页面图片
        $("#upfile").change(function () {
            var fd = new FormData();
            fd.append("upload", 1);
            fd.append("upfile", $(this).get(0).files[0]);
            $.ajax({
               url: "/wapuinfo.php?action=AjaxUpload",
                type: "POST",
                processData: false,
                contentType: false,
               data: fd,
                success: function (d) {
                    if (d) {
                        var path = "/attach/" + d;
                        $("#img").attr('src', path);
//                        location.href = "";
                    }
                }
            });
        })        
    </script>
</body>
</html>
