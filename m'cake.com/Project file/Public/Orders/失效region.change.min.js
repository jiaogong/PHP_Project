E.region.location = [];
E.region.select = {
    'general': {
        p: 'province_list', //省份select的ID
        c: 'city_list', //市区select的ID
        a: 'county_list', //地区select的ID
        pShow: 'y', //y显示指定省份外的省份，n不显示指定省份外的省份
        cShow: 'y', //y显示指定市区外的市区，n不显示指定市区外的市区
        ccShow: 'y' //y显示指定地区外的地区，n不显示指定地区外的地区
    }
};
E.region.init = function( args, act ) {

    if (!act) {
        act = 'general';
    } else if (!E.region.select[act]) {
        E.region.select[act] = {};
    }

    if (args) {
        E.region.select[act] = E.concat(E.region.select[act], args)
    }

    var region = E.region.select[act];

    $.each(this.list, function(k, v) {

        if (region.pShow == 'n' && region.pid != k) {
            return true;
        }

        $('#' + region.p).append('<option class="opt" value="' + k + '">' + v.n + '</option>');

        if (region.pid && region.pid == k) {

            $('#' + region.p).val(k);

            $.each(v.c, function(x, y) {

                if (region.cShow == 'n' && region.cid != x) {
                    return true;
                }

                $('#' + region.c).append('<option class="opt" pid="' + k +'" value="' + x + '">' + y.n + '</option>');

                if (E.inArray(y.n, E.region.location) || (region.cid && region.cid == x)) {

                    $('#' + region.c).val(x);

                    if (E.inArray(y.n, E.region.location)) {
                        $('#' + region.c).trigger('change');
                    }

                    $.each(y.c, function(i, j) {

                        if (region.ccShow == 'n' && region.ccid != i) {
                            return true;
                        }

                        $('#' + region.a).append('<option class="opt" value="' + i + '">' + j.n + '</option>');

                        if (region.ccid && region.ccid == i)
                            $('#' + region.a).val(i);

                    });

                }

            });

        }

    });

    $('#' + region.p).change(function() {
        E.region.provinceChange(act);
    });


    $('#' + region.c).change(function() {
        E.region.cityChange(act);
    });

}

E.region.clearP = function( p ) {
    $('#' + p).find('.opt').remove();
}

E.region.clearC = function( c ) {
    $('#' + c).find('.opt').remove();
}

E.region.clearA = function( a ) {
    $('#' + a).find('.opt').remove();
}

E.region.provinceChange = function( act ) {

    var region = this.select[act];

    this.clearA(region.a);
    this.clearC(region.c);

    var pid = $('#' + region.p).val();

    if (pid == 0)
        return false;

    $.each(this.list[pid]['c'], function(k, v) {

        if (region.cShow == 'n' && region.cid != k) {
            return true;
        }

       $('#' + region.c).append('<option class="opt" pid="' + pid +'" value="' + k + '">' + v.n + '</option>');

        if (E.inArray(v.n, E.region.location)) {

            $('#' + region.c).val(k);

            $.each(v.c, function(i, j) {

                if (region.ccShow == 'n' && region.ccid != i) {
                    return true;
                }

                $('#' + region.a).append('<option class="opt" value="' + i + '">' + j.n + '</option>');

            });

        }

    });

}

E.region.cityChange = function( act ) {

    var region = this.select[act];

    this.clearA(region.a);

    var cid = $('#' + region.c).val(), pid = $('#' + region.c).find('option:selected').attr('pid');

    if (cid == 0)
        return false;

    $.each(this.list[pid]['c'][cid]['c'], function(k, v) {

        if (region.ccShow == 'n' && region.ccid != k) {
            return true;
        }

        $('#' + region.a).append('<option class="opt" value="' + k + '">' + v.n + '</option>');

    });

}

E.region.shopAdd = function( id, c ) {

    var dt = E.getFormValues(id), error_msg = '';
    if (E.empty(dt.custName))
        error_msg += '收货人不能为空，请填写<br />';
    if(dt.custName.length > 15)
        error_msg += '收货人长度不能超过15个汉字或英文字母<br />';
    if (dt.provinceid == 0 || dt.cityid == 0 || dt.countyid == 0)
        error_msg += '请选择省市区<br />';
    if (E.empty(dt.address))
        error_msg += '收货地址不能为空，请填写<br />';
    if (E.empty(dt.mobile) && E.empty(dt.phone))
        error_msg += '“手机”和“固定电话”至少填写一项<br />';
    if (!E.empty(dt.mobile) && !E.isMobile(dt.mobile))
        error_msg += '手机号码填写错误，格式：18612345678，请重新填写';
    if (!E.empty(dt.phone) && !E.isPhone(dt.phone))
        error_msg += '固定电话填写错误，格式：021-60745701，请重新填写';

    if (!E.empty(error_msg)) {
        E.alert(error_msg);
    } else {
        E.loadding.open('正在保存，请稍候...');
        E.ajax_post({
            action: 'deliver',
            operFlg: 2,
            data: dt,
            call: c
        });
    }

}

E.region.backAdd = function( id, c ) {

    var dt = E.getFormValues(id), error_msg = '';
    if (E.empty(dt.custName))
        error_msg += '收货人不能为空，请填写<br />';
    if(dt.custName.length > 15)
        error_msg += '收货人长度不能超过15个汉字或英文字母<br />';
    if (dt.provinceid == 0 || dt.cityid == 0 || dt.countyid == 0)
        error_msg += '请选择省市区<br />';
    if (E.empty(dt.address))
        error_msg += '收货地址不能为空，请填写<br />';
    if (E.empty(dt.mobile) && E.empty(dt.phone))
        error_msg += '“手机号码”和“固定电话”至少填写一项<br />';
    if (!E.empty(dt.mobile) && !E.isMobile(dt.mobile))
        error_msg += '手机号码填写错误，格式：18612345678，请重新填写';
    if (!E.empty(dt.phone) && !E.isPhone(dt.phone))
        error_msg += '固定电话填写错误，格式：021-60745701，请重新填写';

    if (!E.empty(error_msg)) {
        E.alert(error_msg);
    } else {
        E.loadding.open('正在保存，请稍候...');
        E.ajax_post({
            url: '/ajax-backend/customer/deliver.ajax?operFlg=1',
            data: dt,
            call: c
        });
    }

}

E.region.wapAdd = function( id, c ) {

    var dt = E.getFormValues(id), error_msg = '';
    if (E.empty(dt.custName))
        error_msg += '收货人不能为空，请填写<br />';
    if(dt.custName.length > 15)
        error_msg += '收货人长度不能超过15个汉字或英文字母<br />';
    if (E.empty(dt.mobile))
        error_msg += '手机不能为空，请填写<br />';
    if (!E.empty(dt.mobile) && !E.isMobile(dt.mobile))
        error_msg += '手机号码填写错误，格式：18612345678，请重新填写';
    if (E.empty(dt.distribution_id))
        error_msg += '自提点不能为空，请选择<br />';

    if (!E.empty(error_msg)) {
        E.alert(error_msg);
    } else {
        E.loadding.open('正在保存，请稍候...');
        E.ajax_post({
            action: 'deliver',
            operFlg: 2,
            data: dt,
            call: c
        });
    }

}